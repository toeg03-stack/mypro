<!DOCTYPE html>
<html lang="ar" dir="rtl" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ThomasLab | Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø°ÙƒÙŠ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@600;700;900&display=swap');
        
        :root[data-theme="dark"] {
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --text-main: #f8fafc;
            --accent: #38bdf8;
            --border: rgba(255, 255, 255, 0.1);
        }
        :root[data-theme="light"] {
            --bg-color: #f1f5f9;
            --card-bg: #ffffff;
            --text-main: #1e293b;
            --accent: #0284c7;
            --border: rgba(0, 0, 0, 0.1);
        }

        body { 
            font-family: 'Cairo', sans-serif; 
            background-color: var(--bg-color); 
            color: var(--text-main);
            margin: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            transition: all 0.3s ease;
        }

        header {
            background: var(--card-bg);
            padding: 0.8rem 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .header-logo { height: 40px; width: auto; margin-left: 12px; }

        .admin-card {
            background: var(--card-bg);
            border-radius: 24px;
            border: 1px solid var(--border);
            overflow: hidden;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2);
        }

        .custom-input {
            width: 100%;
            background-color: rgba(15, 23, 42, 0.5);
            border: 1px solid var(--border);
            padding: 10px 14px;
            border-radius: 12px;
            color: var(--text-main);
            outline: none;
            transition: 0.2s;
        }
        [data-theme="light"] .custom-input { background-color: #f8fafc; color: #1e293b; }

        .custom-input:focus { border-color: var(--accent); ring: 2px var(--accent); }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± - ØªØ¸Ù„ Ø¨ÙŠØ¶Ø§Ø¡ Ø¯Ø§Ø¦Ù…Ø§Ù‹ ÙƒÙ…Ø§ Ù‡ÙŠ ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ Ù„Ø¶Ù…Ø§Ù† Ø¬ÙˆØ¯Ø© Ø§Ù„ØµÙˆØ±Ø© */
        #capture-area { 
            display: inline-block;
            background: white;
            padding: 15px; 
            border: 1px solid #cbd5e1;
            direction: rtl;
            color: #1e293b; /* Ù†ØµÙˆØµ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø³ÙˆØ¯Ø§Ø¡ Ø¯Ø§Ø¦Ù…Ø§Ù‹ */
        }
        .name-text { font-size: 14px; font-weight: 700; color: #1e293b; }
        .index-num { font-size: 11px; font-weight: 900; margin-left: 8px; width: 25px; flex-shrink: 0; text-align: left; }
        .names-grid { display: grid; gap: 2px 15px; grid-auto-flow: column; }
        .name-item { display: flex; align-items: center; padding: 3px 5px; width: 185px; border-bottom: 1px solid #f1f5f9; white-space: nowrap; }

        footer {
            padding: 1rem;
            text-align: center;
            background: var(--card-bg);
            border-top: 1px solid var(--border);
            margin-top: auto;
        }
    </style>
</head>
<body>

    <header>
        <div class="flex items-center">
            <a href="index.html" class="bg-slate-700 text-white px-3 py-1 rounded-lg text-sm ml-4 hover:bg-slate-600 transition">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            <div class="flex items-center">
                <img src="https://cdn-icons-png.flaticon.com/512/3211/3211468.png" alt="Logo" class="header-logo"> <h1 class="text-lg font-black tracking-tight">ThomasLab's <span class="font-light opacity-70">| ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ±</span></h1>
            </div>
        </div>
        <button onclick="toggleTheme()" class="border border-sky-500 text-sky-500 px-4 py-1 rounded-full text-sm hover:bg-sky-500 hover:text-white transition">ğŸŒ“ ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¸Ù‡Ø±</button>
    </header>

    <main class="p-4 md:p-8">
        <div class="max-w-5xl mx-auto admin-card shadow-2xl">
            <div class="bg-gradient-to-r from-slate-900 to-slate-800 p-4 text-center border-b border-slate-700">
                <h2 class="text-xl font-bold text-white flex justify-center items-center gap-2">
                    <span class="text-2xl">ğŸ“Š</span> Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                </h2>
            </div>

            <div class="p-6">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2 space-y-4">
                        <div>
                            <label class="text-xs font-bold opacity-70 mb-1 block">ğŸ“ Ø§Ø³Ù… Ø§Ù„ÙƒÙ†ÙŠØ³Ø©</label>
                            <input type="text" id="churchName" value="ÙƒÙ†ÙŠØ³Ø© Ø§Ù„Ø³ÙŠØ¯Ø© Ø§Ù„Ø¹Ø°Ø±Ø§Ø¡ Ù…Ø±ÙŠÙ… ÙˆØ§Ù„Ù‚Ø¯ÙŠØ³ ÙŠÙˆØ³Ù Ø§Ù„Ù†Ø¬Ø§Ø±" class="custom-input">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-xs font-bold opacity-70 mb-1 block">â›ª Ø§Ù„Ø®Ø¯Ù…Ø©</label>
                                <input type="text" id="serviceName" value="Ø®Ø¯Ù…Ø© Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ø§Ø­Ø¯" class="custom-input">
                            </div>
                            <div>
                                <label class="text-xs font-bold opacity-70 mb-1 block">ğŸ‘¥ Ø§Ù„Ø£Ø³Ø±Ø©</label>
                                <input type="text" id="familyName" value="Ø§Ø³Ø±Ø© Ø§Ø¹Ø¯Ø§Ø¯ÙŠ Ø¨Ù†ÙŠÙ†" class="custom-input">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-xs font-bold opacity-70 mb-1 block">ğŸ« Ø§Ø³Ù… Ø§Ù„ÙØµÙ„</label>
                                <input type="text" id="className" placeholder="Ù…Ø«Ø§Ù„: Ø£ÙˆÙ„Ù‰ Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ" class="custom-input">
                            </div>
                            <div>
                                <label class="text-xs font-bold opacity-70 mb-1 block">ğŸ“ Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</label>
                                <select id="reportType" class="custom-input">
                                    <option value="Ø­Ø¶ÙˆØ±">Ø­Ø¶ÙˆØ± âœ…</option>
                                    <option value="ØºÙŠØ§Ø¨">ØºÙŠØ§Ø¨ âŒ</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="bg-slate-800/50 p-4 rounded-2xl border border-white/5 space-y-4">
                        <div class="grid grid-cols-2 gap-2">
                            <div class="col-span-2 text-xs font-bold text-sky-400">ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ</div>
                            <select id="dayMiladi" class="custom-input"></select>
                            <select id="monthMiladi" class="custom-input">
                                <option value="ÙŠÙ†Ø§ÙŠØ±">ÙŠÙ†Ø§ÙŠØ±</option><option value="ÙØ¨Ø±Ø§ÙŠØ±">ÙØ¨Ø±Ø§ÙŠØ±</option><option value="Ù…Ø§Ø±Ø³">Ù…Ø§Ø±Ø³</option><option value="Ø£Ø¨Ø±ÙŠÙ„">Ø£Ø¨Ø±ÙŠÙ„</option><option value="Ù…Ø§ÙŠÙˆ">Ù…Ø§ÙŠÙˆ</option><option value="ÙŠÙˆÙ†ÙŠÙˆ">ÙŠÙˆÙ†ÙŠÙˆ</option><option value="ÙŠÙˆÙ„ÙŠÙˆ">ÙŠÙˆÙ„ÙŠÙˆ</option><option value="Ø£ØºØ³Ø·Ø³">Ø£ØºØ³Ø·Ø³</option><option value="Ø³Ø¨ØªÙ…Ø¨Ø±">Ø³Ø¨ØªÙ…Ø¨Ø±</option><option value="Ø£ÙƒØªÙˆØ¨Ø±">Ø£ÙƒØªÙˆØ¨Ø±</option><option value="Ù†ÙˆÙÙ…Ø¨Ø±">Ù†ÙˆÙÙ…Ø¨Ø±</option><option value="Ø¯ÙŠØ³Ù…Ø¨Ø±">Ø¯ÙŠØ³Ù…Ø¨Ø±</option>
                            </select>
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <div class="col-span-2 text-xs font-bold text-amber-500">ğŸ“œ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‚Ø¨Ø·ÙŠ</div>
                            <select id="dayCoptic" class="custom-input"></select>
                            <select id="monthCoptic" class="custom-input">
                                <option value="ØªÙˆØª">ØªÙˆØª</option><option value="Ø¨Ø§Ø¨Ø©">Ø¨Ø§Ø¨Ø©</option><option value="Ù‡Ø§ØªÙˆØ±">Ù‡Ø§ØªÙˆØ±</option><option value="ÙƒÙŠÙ‡Ùƒ">ÙƒÙŠÙ‡Ùƒ</option><option value="Ø·ÙˆØ¨Ø©">Ø·ÙˆØ¨Ø©</option><option value="Ø£Ù…Ø´ÙŠØ±">Ø£Ù…Ø´ÙŠØ±</option><option value="Ø¨Ø±Ù…Ù‡Ø§Øª">Ø¨Ø±Ù…Ù‡Ø§Øª</option><option value="Ø¨Ø±Ù…ÙˆØ¯Ø©">Ø¨Ø±Ù…ÙˆØ¯Ø©</option><option value="Ø¨Ø´Ù†Ø³">Ø¨Ø´Ù†Ø³</option><option value="Ø¨Ø¤ÙˆÙ†Ø©">Ø¨Ø¤ÙˆÙ†Ø©</option><option value="Ø£Ø¨ÙŠØ¨">Ø£Ø¨ÙŠØ¨</option><option value="Ù…Ø³Ø±Ù‰">Ù…Ø³Ø±Ù‰</option><option value="Ù†Ø³ÙŠØ¡">Ù†Ø³ÙŠØ¡</option>
                            </select>
                        </div>
                        <label class="block w-full border-2 border-dashed border-slate-600 rounded-xl p-4 text-center hover:border-sky-500 transition cursor-pointer">
                            <span class="text-2xl">ğŸ“</span>
                            <p class="text-[10px] font-bold opacity-60">Ø±ÙØ¹ Ù…Ù„Ù Ø¥ÙƒØ³ÙŠÙ„</p>
                            <input type="file" id="excelFile" accept=".xlsx, .xls" class="hidden">
                        </label>
                    </div>
                </div>

                <button onclick="processData()" class="w-full mt-6 bg-sky-600 hover:bg-sky-500 text-white font-black py-4 rounded-xl shadow-lg transition transform active:scale-95">
                    ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ âœ¨
                </button>
            </div>
        </div>

        <div class="flex flex-col items-center mt-12 pb-10">
            <div id="capture-area" class="hidden shadow-2xl">
                <div class="header-top-info text-center border-b pb-2 mb-2">
                    <h3 id="out-church" style="font-size: 15px; font-weight: 900; color: #1e293b;"></h3>
                    <div style="font-size: 12px; font-weight: 700; color: #64748b;">
                        <span id="out-service"></span> - <span id="out-family"></span>
                    </div>
                </div>

                <div id="header-row" class="flex justify-between items-center px-4 py-2 text-white rounded mb-3">
                    <span id="out-miladi" style="font-size: 11px; font-weight: 800; width: 25%;"></span>
                    <h1 id="out-mainTitle" style="font-size: 19px; font-weight: 900; width: 50%; text-align: center;"></h1>
                    <span id="out-coptic" style="font-size: 11px; font-weight: 800; width: 25%; text-align: left;"></span>
                </div>

                <div id="names-grid" class="names-grid"></div>
            </div>

            <button id="downloadBtn" class="hidden mt-6 bg-emerald-600 hover:bg-emerald-500 text-white px-8 py-3 rounded-full font-bold shadow-xl transition-all">
                Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙƒØµÙˆØ±Ø© ğŸ“¥
            </button>
        </div>
    </main>

    <footer>
        <p class="text-sm opacity-80">Powered by 
            <a href="https://linkedin.com/in/YOUR_PROFILE" target="_blank" class="text-sky-400 font-bold hover:underline">ThomasLab's</a>
        </p>
    </footer>

    <script>
        // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø¸Ø§Ù‡Ø±
        function toggleTheme() {
            const html = document.documentElement;
            const current = html.getAttribute('data-theme');
            html.setAttribute('data-theme', current === 'dark' ? 'light' : 'dark');
        }

        // Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£ØµÙ„ÙŠØ© (Ø¨Ø¯ÙˆÙ† ØªØ¹Ø¯ÙŠÙ„)
        window.onload = function() {
            const dMiladi = document.getElementById('dayMiladi');
            const dCoptic = document.getElementById('dayCoptic');
            for(let i=1; i<=31; i++) {
                dMiladi.options.add(new Option(i, i));
                if(i <= 30) dCoptic.options.add(new Option(i, i));
            }
        };

        function processData() {
            const fileInput = document.getElementById('excelFile');
            if (!fileInput.files[0]) return alert("Ø¨Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³ÙŠÙ„");
            const reader = new FileReader();
            reader.onload = function(e) {
                const workbook = XLSX.read(new Uint8Array(e.target.result), {type: 'array'});
                const rows = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]]);
                let nameKey = Object.keys(rows[0] || {}).find(k => k.includes("Ø§Ù„Ø§Ø³Ù…") || k.includes("Ø§Ø³Ù…"));
                const names = rows.map(r => String(r[nameKey] || "").trim().replace(/\s+/g, ' ').split(' ').slice(0, 3).join(' ')).filter(n => n.length > 2);
                renderOfficial(names);
            };
            reader.readAsArrayBuffer(fileInput.files[0]);
        }

        function renderOfficial(names) {
            const type = document.getElementById('reportType').value;
            const color = type === "Ø­Ø¶ÙˆØ±" ? "#059669" : "#dc2626";
            
            document.getElementById('out-church').innerText = document.getElementById('churchName').value;
            document.getElementById('out-service').innerText = document.getElementById('serviceName').value;
            document.getElementById('out-family').innerText = document.getElementById('familyName').value;
            
            document.getElementById('header-row').style.backgroundColor = color;
            document.getElementById('out-mainTitle').innerText = `${type} ${document.getElementById('className').value}`;
            document.getElementById('out-miladi').innerText = document.getElementById('dayMiladi').value + " " + document.getElementById('monthMiladi').value;
            document.getElementById('out-coptic').innerText = document.getElementById('dayCoptic').value + " " + document.getElementById('monthCoptic').value;

            const grid = document.getElementById('names-grid');
            grid.innerHTML = '';
            const count = names.length;
            let bestCols = 1;
            let minDiff = Infinity;
            for (let c = 1; c <= 6; c++) {
                let r = Math.ceil(count / c);
                let diff = Math.abs((c * 185) - (r * 32 + 150));
                if (diff < minDiff) { minDiff = diff; bestCols = c; }
            }
            let finalRows = Math.ceil(count / bestCols);
            grid.style.gridTemplateColumns = `repeat(${bestCols}, 1fr)`;
            grid.style.gridTemplateRows = `repeat(${finalRows}, auto)`;

            names.forEach((name, i) => {
                const div = document.createElement('div');
                div.className = "name-item";
                div.innerHTML = `<span style="color:${color}" class="index-num">${i+1}.</span><span class="name-text">${name}</span>`;
                grid.appendChild(div);
            });

            document.getElementById('capture-area').classList.remove('hidden');
            document.getElementById('downloadBtn').classList.remove('hidden');
            
            document.getElementById('downloadBtn').onclick = function() {
                html2canvas(document.getElementById('capture-area'), {
                    scale: 3,
                    useCORS: true,
                    backgroundColor: "#ffffff"
                }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = `ØªÙ‚Ø±ÙŠØ±_${document.getElementById('className').value}.png`;
                    link.href = canvas.toDataURL("image/png", 1.0);
                    link.click();
                });
            };
        }
    </script>
</body>
</html>